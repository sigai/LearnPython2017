#!/usr/bin/env python
# -*- coding: UTF-8 -*-
__author__ = "Sigai"
import re

from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from html import unescape
from requests_html import HTML, HTMLSession
import json

chrome_options = Options()
opener = webdriver.Chrome(chrome_options=chrome_options)

nodes = ["2010", "2012", "2014", "2015", "2016", "2018", "2019", "2023", "2025", "2026",
         "2027", "2047", "2049", "2051", "2053", "2054", "2056", "2057", "2064", "2065",
         "2066", "2067", "2069", "2070", "2071", "2072", "2074", "2075", "2076", "2077",
         "2079", "2084", "2085", "2086", "2088", "2092", "2094", "2095", "2096", "2097",
         "2098", "2099", "2100", "2102", "2105", "2106", "2108", "2109", "2110", "2111",
         "2112", "2116", "2117", "2118", "2119", "2120", "2121", "2122", "2124", "2125",
         "2126", "2127", "2129", "2130", "2131", "2132", "2133", "2135", "2136", "2137",
         "2139", "2140", "2141", "2144", "2150", "2152", "2155", "2160", "2162", "2164",
         "2168", "2169", "2170", "2184", "2186", "2190", "2191", "2192", "2193", "2194",
         "2195", "2196", "2204", "2206", "2212", "2213", "2216", "2218", "2229", "2239",
         "2242", "2247", "2248", "2250", "2251", "2257", "2279", "2316", "2317", "2318",
         "2319", "2326", "2336", "2344", "2346", "2348", "2349", "2350", "2351", "2352",
         "2356", "2367", "2369", "2370", "2377", "2378", "2379", "2380", "2381", "2382",
         "2383", "2384", "2409", "2646", "2647", "2648", "2649", "2651", "2652", "2653",
         "6675", "6676", "6677", "7239", "7240", "7241", "7433", "7441", "7483", "7513",
         "7536", "7540", "7786", "7970", "8022", "10247", "10248", "10250", "10254", "10435",
         "10440", "10743", "11745", "12510", "12511", "12512", "12565", "12653", "12940", "12941",
         "12945", "13455", "13570", "13571", "13572", "13631", "13632", "13633", "18483", "18484",
         "18485", "18486", "18487", "18488", "18489", "18490", "18491", "18492", "18493", "18494",
         "18495", "18496", "18497", "18498", "18499", "18500", "18501", "18502", "18503", "18504",
         "18505", "18506", "18507", "18508", "18509", "18510", "18511", "18512", "18513", "18514",
         "18515", "18516", "18544", "18545", "18546", "18547", "18548", "18549", "18550", "18551",
         "18553", "18554", "18555", "20412", "20413", "20414", "20415", "20416", "20417", "20418",
         "20419", "20420", "20421", "20422", "20423", "20424", "20425", "20426", "20427", "20428",
         "20429", "20430", "20431", "20432", "27064", "31709", "31710", "31711", "31712", "31713",
         "31714", "33362"]

url = "http://download.cnet.com/apps/xhr/?page={p}&node={node}&platform=windows"

for node in nodes[2:]:
    p = 0
    while True:
        p += 1
        try:
            opener.get(url.format(p=p, node=node))
        except Exception as e:
            print(e)
        res = opener.page_source[121:-20]
        try:
            r = json.loads(res)
        except Exception as e:
            print(e)
            continue
        doc = r['_html']
        if doc.strip():
            dom = HTML(html=doc)
        else:
            break
        print(node, p)
        with open(f"{node}.txt", mode='a', encoding='utf-8') as m:
            m.write('\n'.join(dom.links) + '\n')
